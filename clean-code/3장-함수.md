# 작게 만들어라!
함수를 만드는 첫째 규칙은 '작게!'다. 함수를 만드는 둘째 규칙은 '더 작게!'다. 이 규칙은 근거를 대기가 곤란하다. 함수가 작을수록 더 좋다는 증거나 자료를 제시하기도 어렵다. 하지만 나는 지난 40여년 동안 온갖 크기로 함수를 구현해봤다. 거의 3,000줄에 육박하는 끔찍한 함수도 짰다. 100줄에서 300줄에 달하는 함수도 많이 짰다. 20줄에서 30줄 정도인 함수도 짰다. 지금까지 경험을 바탕으로 그리고 오랜 시행착오를 바탕으로 나는 작은 함수가 좋다고 확신한다.

80년대에는 함수가 한 화면을 넘어가면 안된다고 말했다. 당시 VT100 화면은 가로 80자 세로 24줄이었고 우리 편집기는 4줄을 관리용으로 사용했다. 이제는 크고 좋은 모니터에 좋은 글꼴을 조절하면 한 화면에 가로 150자 세로 100줄도 들어간다. 가로 150자를 넘어서는 안 된다. 함수는 100줄을 넘어서는 안 된다. 아니 20줄도 길다.

그렇다면 얼마나 짧아야 좋을까? 1999년 나는 오레곤 주에 사는 켄트 백을 방문했다. 우리는 같이 앉아 프로그램을 짰는데, 도중에 그가 Sparkle 이라는 자그만 자바/스윙 프로그램을 보여줬다. 신데렐라 영화에서 요정 할머니가 휘두르는 마법의 지팡이처럼 화면에 반짝이를 뿌려주는 프로그램이었다. 마우스를 움직이면 커서를 따라가며 반짝이가 뿌려졌다. 뿌려진 반짝이는 중력이 적용되어 화면 아래로 서서히 떨어졌다. 켄트가 코드를 보여줬을 때 나는 함수가 너무나도 놀랐다. 그때까지 나는 장황하게 긴 스윙 프로그램 함수에 익숙했다. 그런데 Sparkle 은 모든 함수가 2줄, 3줄, 4줄 정도였다. 각 함수가 너무도 명백했다. 각 함수가 이야기 하나를 표현했다. 각 함수가 너무도 멋지게 다음 무대를 준비했다. 이것이 답이다!

함수가 얼마나 짧아야 하느냐고? 일반적으로 14줄보다 짧아야 한다! 사실 14줄은 6줄로 줄여야 마땅하다.

* HtmlUtil

```java
public static String renderPageWithSetupsAndTeardowns (
	PageData pageData, boolean isSuite) throws Exception {
		if (isTestPage(pageData))
			includeSetupAndTeardownPages(pageData, isSuite);
		return pageData.getHtml();
	}
}
```
*블록과 들여쓰기*
다시 말해, if 문 / else 문 / while 문에 들어가는 블록은 한 줄이어야 한다는 의미다. 대개 거기서 함수를 호출한다. 그러면 바깥을 감싸는 함수가 작아질 뿐 아니라, 블록 안에서 호출하는 함수 이름을 적절히 짓는다면, 코드를 이해하기도 쉬워진다.

이 말은 중첩 구조가 생길만큼 함수가 커져서는 안 된다는 뜻이다. 그러므로 함수에서 들여쓰기 수준은 1단이나 2단을 넘어서면 안 된다. 당연한 말이지만, 그래야 함수는 읽고 이해하기 쉬워진다.

# 서술적인 이름을 사용하라!

함수 이름 testableHtml을 SetupTeardownIncluder.render로 변경했다. 함수가 하는 일을 좀 더 잘 표현하므로 훨씬 좋은 이름이다. 그리고 나는 private 함수에도 isTestable, includesetupAndTeardownPages 등과 같이 서술적인 이름을 지었다. 좋은 이름이 주는 가치는 아무리 강조해도 지나치지 않다. 워드가 말했던 원칙을 기억하는가? "코드를 읽으면서 짐작했던 기능을 각 루틴이 그대로 수행한다면 깨끗한 코드라 불러도 되겠다." 한 가지만 하는 작은 하수에 좋은 이름을 붙인다면 이런 원칙을 달성함에 있어 이미 절반은 성공했다. 함수가 작고 단순할수록 서술적인 이름도 고르기 쉬워진다.

이름이 길어도 괜찮다. 겁먹을 필요없다. 길고 서술적인 이름이 짧고 어려운 이름보다 좋다. 길고 서술적인 이름이 길고 서술적인 주석보다 좋다. 함수 이름을 정할 때는 여러 단어가 쉽게 읽히는 명명법을 사용한다. 그런 다음, 여러 단어를 사용해 함수 기능을 잘 표현하는 이름을 선택한다.

이름을 정하느라 시간을 들여도 괜찮다. 이런저런 이름을 넣어 코드를 읽어보면 더 좋다. 이클립스나 인텔리제이 같은 최신 IDE에서 이름 바꾸기는 식은 죽 먹기다. IDE를 사용해 이런저런 이름을 시도한 후 최대한 서술적인 이름을 골라도 좋겠다.

서술적인 이름을 사용하면 개발자 머릿속에서도 설계가 뚜렷해지므로 코드를 개선하기 쉬워진다. 좋은 이름을 고른 후 코드를 더 좋게 재구성하는 사례도 없지 않다.

이름을 붙일 때는 일관성 있어야 한다. 모듈 내에서 함수 이름은 같은 문구, 명사, 동사를 사용한다. includeSetupAndTeardownPages, includeSetupPages, includeSuiteSetupPage, includeSetupPages 등이 좋은 예다. 문체가 비슷하면 이야기를 순차적으로 풀어가기도 쉬워진다. 방금 열거한 함수를 살펴보라. 당장 이런 질문이 떠오르리라. "includeTeardownPages, includeSuiteTeardownPage, includeTeardownPage도 있나요?" 당연하다. '짐작하는 대로'다.

# 부수 효과를 일으키지 마라!

부수 효과는 거짓말이다. 함수에서 한 가지를 하겠다고 약속하고선 남몰래 다른 짓도 하니까. 때로는 예상치 못하게 클래스 변수를 수정한다. 때로는 함수로 넘어온 인수나 시스템 전역 변수를 수정한다. 어느 쪽이든 교활하고 해로운 거짓말이다. 많은 경우 시간적인 결합이나 순서 종속성 을 초래한다. 

아주 무해하게 보이는 함수다. 함수는 표준 알고리즘을 사용해 userName 과 password 를 확인한다. 두 인수가 올바르면 true 를 반환하고 아니면 false 를 반환한다. 하지만 함수는 부수 효과를 일으킨다. 보이는가?

```java
public class UserValidator {
	private Cryptographer cryptographer;
	
	public boolean checkPassword(String userName, String password) {
		User user = UserGateway.findByName(userName);
		if (user != User.NULL) {
			String codePhrse = user.getPhraseEncodedByPassword();
			String phrase = cryptographer.decrypt(codedPhrase, password)
			if ("Valid Password".equals(phrase)) {
				Session.initialize();
				return true;
			}
		}
		return false;
	}
}
```

여기서, 함수가 일으키는 부수 효과는 Session.initialize() 호출이다. checkPassword 함수는 이름 그대로 암호를 확인한다. 이름만 봐서는 세션을 초기화한다는 사실이 드러나지 않는다. 그래서 함수 이름만 보고 함수를 호출하는 사용자는 사용자를 인증하면서 기존 세션 정보를 지워버릴 위험에 처한다. 

이런 부수 효과가 시간적인 결함을 초래한다. 즉, checkPassword 함수는 특정 상황에서만 호출이 가능하다. 다시 말해, 세션을 초기화해도 괜찮은 경우에만 호출이 가능하다. 자칫 잘못 호출하면 의도하지 않게 세션 정보가 날아간다. 시간적인 결합은 혼란을 일으킨다. 특히 부수 효과로 숨겨진 경우에는 더더욱 혼란이 커진다. 만약 시간적인 결합이 필요하다면 함수 이름에 분명히 명시한다. checkPasswordAndInitializeSession 이라는 이름이 훨씬 좋다. 물론 함수가 '한가지'만 한다는 규칙을 위반하지만.